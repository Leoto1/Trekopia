<% include ../partials/header %>
<br>
<div class="container" style="min-width: 80%;">
    <%if(currentUser && trek.author._id.equals(currentUser._id)){%>
            <div class="list-group-item list-group-item-warning form-inline">
                <div class ="form-check">
                <p>It seems you have created this post. Do you want to</p>
                </div>
                <div class ="form-check">
                <a  href="/treks/<%=trek._id%>/edit">
                    <button class="btn bton-theme">Edit</button>
                </a>
                </div>
                <div class ="form-check">
                <form action="/treks/<%=trek._id%>?_method=DELETE" method="POST">
                    <button class="btn bton-theme">Delete</button>
                </form>
                </div>
            </div>
    <%}%>
 
    <br>
    <div class="row">
    <div class="col-md-8 col-sm-12">
        <img class="img-fluid" style="min-width: 100%; height:auto" src="<%= trek.images %>">
    </div>
    <div  class="col-md-4 col-sm-12">
        <div id='map'></div>
        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoibWF5YW5rcmFtaW5hIiwiYSI6ImNqbDE0aGNzdTFicnUzd2xtdTdsMXp2eDYifQ.4CD85rpzoEw_kOEKH1KcsQ';
            const map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mayankramina/cjl164vhj2i8i2smme0wux9pc',
                center: [<%=trek.lon%>, <%=trek.lat%>],
                zoom: 10.0
            });
            var popup = new mapboxgl.Popup().setText('<%=trek.name%>');
            var marker = new mapboxgl.Marker().setLngLat([<%=trek.lon%>, <%=trek.lat%>]).setPopup(popup).addTo(map);
            
        </script>
    </div>
    </div>
    <br>
    <div class="row">
        <h3 class="text-left col">
            <%= trek.name %>
        </h3>
        <h5 class="text-right col">
         â‚¹ <%= trek.cost%>
        </h5>
    </div>
    <div>
        <h6 class="text-left">
            <%= trek.location %>
        </h6>
    </div>
    <hr>
    <div>

    </div>
    <div>
        <%= trek.description %>
    </div>
    <hr>
    <h5>Comments</h5>
        <% trek.comments.forEach(function(comment){%>
            <div>
                <strong><%=comment.author.name%></strong> - <%=comment.content%>
            </div>
        <%if(currentUser && comment.author.id.equals(currentUser._id)){%>
                <a href="/treks/<%=trek._id%>/comments/<%= comment._id%>/edit">
                    <button class="btn btn-outline-primary">Edit</button>
                </a>
        <%}%>
        <%if(currentUser && comment.author.id.equals(currentUser._id) || currentUser && trek.author.equals(currentUser._id)){%>
                <form action="/treks/<%=trek._id%>/comments/<%= comment._id%>?_method=DELETE" method="POST">
                    <button class="btn btn-outline-primary">Delete</button>
                </form>
        <%}%>
        <br>
        <%}) %>
    <div>Add a comment</div>
    <% if(!currentUser){ %>
        <div>To add a comment you need to <a href="/login">Log In</a> or <a href="/register">Sign Up</a></div>
    <% } else { %>
    <form class="form-group" action="/treks/<%= trek._id%>/comments" method="POST">
        <div class="form-group">

            <input class="form-control"  style="max-width: 500px;"type="text" name="comment[content]"  placeholder="comment">
        </div>
        <button class="btn bton-theme">Submit!</button>
    </form>
    <% } %>
</div>
    <% include ../partials/footer %>